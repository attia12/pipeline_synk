<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Driver Location Update</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.2/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>Update Your Location</h1>
<input type="number" id="latitude" placeholder="Latitude" step="0.0001">
<input type="number" id="longitude" placeholder="Longitude" step="0.0001">
<button onclick="updateLocation()">Send Location</button>
<div id="status">Connecting...</div>

<script>
    // Use the same moveId as the client
    const moveId = "6901d94d-b970-416c-915d-857303d4feee";
    const jwtToken = "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJtb2hhbWVkLmFpY2hhb3VpLnRpY0BnbWFpbC5jb20iLCJyb2xlcyI6WyJST0xFX0RSSVZFUiJdLCJ1c2VySWQiOiI2N2ZmNzgyZmE0NDU4NzExMTNmNTlmY2YiLCJpYXQiOjE3NDUzMjk1NTcsImV4cCI6MTc0NTMzMzE1N30.UOn1ddVuhcH4x2G7oxb-qF2J4LyWqK_RMCjoEsW7JW0";
    const socket = new SockJS('http://localhost:8090/ws');
    const stompClient = Stomp.over(socket);

    stompClient.connect({'Authorization': jwtToken}, function (frame) {
        document.getElementById('status').innerText = 'Connected';
        console.log('Connected: ' + frame);
    }, function (error) {
        document.getElementById('status').innerText = 'Connection Error: ' + error;
        console.error('Connection error:', error);
    });

    function updateLocation() {
        const lat = document.getElementById('latitude').value;
        const lon = document.getElementById('longitude').value;
        if (lat && lon) {
            const location = { latitude: parseFloat(lat), longitude: parseFloat(lon) };
            stompClient.send('/app/mission/' + moveId + '/location', {}, JSON.stringify(location));
            console.log('Location sent:', location);
        }
    }
</script>
</body>
</html>